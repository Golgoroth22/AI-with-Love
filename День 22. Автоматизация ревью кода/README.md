# День 22. Автоматизация ревью кода

1. Настройте пайплайн (CI), в котором ассистент анализирует новый PR
2. C помощью RAG использует документацию и код для контекста
3. через MCP получает diff и файлы из PR
4. Ассистент должен выдавать текст ревью с замечаниями

- `Результат`: 
1. GitHub Action запускается на PR
2. Ассистент получает diff
3. Отдаёт: найденные проблемы, потенциальные баги, советы по улучшению
- `Формат`: Видео + Код

[Видео результата](https://drive.google.com/file/d/1loM2yCJynpbD1NfFCf3bFTopkyVWlrlM/view?usp=sharing)

Код mcp-сервера в директории **server/**


🔍 RAG & Document Processing Tools (6 инструментов)
┌─────────────────────┬────────────────────────────────────────────────────────────────────────────────────────────┬────────────┐
│    Инструмент       │                                      Описание                                              │   Сервер   │
├─────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────┼────────────┤
│ semantic_search     │ Поиск релевантных фрагментов документов с использованием семантического сходства          │ RAG Server │
├─────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────┼────────────┤
│ create_embedding    │ Генерация эмбеддингов для текста с использованием модели Ollama nomic-embed-text          │ RAG Server │
├─────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────┼────────────┤
│ save_document       │ Сохранение документа с эмбеддингами и информацией о цитировании в локальную БД             │ RAG Server │
├─────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────┼────────────┤
│ search_similar      │ Поиск похожих документов с использованием косинусного сходства в локальной БД              │ RAG Server │
├─────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────┼────────────┤
│ process_pdf         │ Извлечение текста из PDF, разбиение на фрагменты и сохранение с эмбеддингами              │ RAG Server │
├─────────────────────┼────────────────────────────────────────────────────────────────────────────────────────────┼────────────┤
│ process_text_chunks │ Обработка извлечённого текста на фрагменты с эмбеддингами (параллельная обработка)        │ RAG Server │
└─────────────────────┴────────────────────────────────────────────────────────────────────────────────────────────┴────────────┘
🐙 GitHub MCP Tools (8 инструментов)
┌──────────────────┬─────────────────────────────────────────────────────────────────────────────────────────┬────────────────────────┐
│   Инструмент     │                                      Описание                                           │    Активация           │
├──────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┼────────────────────────┤
│ get_repo         │ Получение детальной информации о GitHub репозитории (звёзды, форки, описание и т.д.)    │ Ключевое слово         │
│                  │                                                                                         │ "GitWithLove"          │
├──────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┼────────────────────────┤
│ search_code      │ Поиск кода в GitHub репозиториях с использованием синтаксиса поиска GitHub              │ Ключевое слово         │
│                  │                                                                                         │ "GitWithLove"          │
├──────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┼────────────────────────┤
│ create_issue     │ Создание нового issue в GitHub репозитории                                              │ Ключевое слово         │
│                  │                                                                                         │ "GitWithLove"          │
├──────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┼────────────────────────┤
│ list_issues      │ Список issues из репозитория (фильтр по состоянию: open/closed/all)                    │ Ключевое слово         │
│                  │                                                                                         │ "GitWithLove"          │
├──────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┼────────────────────────┤
│ list_commits     │ Список коммитов из истории репозитория                                                  │ Ключевое слово         │
│                  │                                                                                         │ "GitWithLove"          │
├──────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┼────────────────────────┤
│ get_repo_content │ Получение содержимого файлов или списка директорий из GitHub репозитория                │ Ключевое слово         │
│                  │                                                                                         │ "GitWithLove"          │
├──────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┼────────────────────────┤
│ get_pull_request │ Получение метаданных Pull Request (заголовок, автор, статистика, статус) 🆕            │ Ключевое слово         │
│                  │                                                                                         │ "ReviewPR"             │
├──────────────────┼─────────────────────────────────────────────────────────────────────────────────────────┼────────────────────────┤
│ get_pr_files     │ Получение списка изменённых файлов PR с diff и patch (до 30 файлов) 🆕                 │ Ключевое слово         │
│                  │                                                                                         │ "ReviewPR"             │
└──────────────────┴─────────────────────────────────────────────────────────────────────────────────────────┴────────────────────────┘
🌿 Local Git Tools (4 инструмента)
┌───────────────┬──────────────────────────────────────────────────────────────────────────────────────────────┬────────────────────┐
│  Инструмент   │                                        Описание                                              │    Активация       │
├───────────────┼──────────────────────────────────────────────────────────────────────────────────────────────┼────────────────────┤
│ git_status    │ Получение текущего статуса репозитория (изменённые файлы, staged файлы, текущая ветка)      │ Ключевое слово     │
│               │                                                                                              │ "GitLocal"         │
├───────────────┼──────────────────────────────────────────────────────────────────────────────────────────────┼────────────────────┤
│ git_branch    │ Список всех локальных и удалённых веток с указанием текущей активной ветки                  │ Ключевое слово     │
│               │                                                                                              │ "GitLocal"         │
├───────────────┼──────────────────────────────────────────────────────────────────────────────────────────────┼────────────────────┤
│ git_diff      │ Получение diff для файлов (unstaged или staged изменения)                                    │ Ключевое слово     │
│               │                                                                                              │ "GitLocal"         │
├───────────────┼──────────────────────────────────────────────────────────────────────────────────────────────┼────────────────────┤
│ git_pr_status │ Проверка статуса Pull Request для текущей ветки, комбинируя локальный git с GitHub API      │ Ключевое слово     │
│               │                                                                                              │ "GitLocal"         │
└───────────────┴──────────────────────────────────────────────────────────────────────────────────────────────┴────────────────────┘
🧪 Legacy Tools (4 инструмента - остались в коде с ранних дней)
┌─────────────────┬────────────────────────────────────┬────────────────────────────────────┐
│   Инструмент    │             Описание               │             Статус                 │
├─────────────────┼────────────────────────────────────┼────────────────────────────────────┤
│ get_joke        │ Получение шуток из JokeAPI         │ Работает, но не используется       │
├─────────────────┼────────────────────────────────────┼────────────────────────────────────┤
│ save_joke       │ Сохранение шутки в базу данных     │ Работает, но не используется       │
├─────────────────┼────────────────────────────────────┼────────────────────────────────────┤
│ get_saved_jokes │ Извлечение сохранённых шуток       │ Работает, но не используется       │
├─────────────────┼────────────────────────────────────┼────────────────────────────────────┤
│ run_tests       │ Запуск тестов MCP сервера          │ Работает, но не используется       │
└─────────────────┴────────────────────────────────────┴────────────────────────────────────┘
---

## 📊 Итоги

- **Всего инструментов**: 22
    - RAG/Embeddings: 6 инструментов
    - GitHub MCP: 8 инструментов (включая 2 новых для ревью PR 🆕)
    - Local Git: 4 инструмента
    - Legacy: 4 инструмента

## 🎯 Как использовать

1. **Поиск в документах**: Используйте `/help <вопрос>` для локального RAG поиска
2. **GitHub операции**: Включите ключевое слово `"GitWithLove"` в ваше сообщение
3. **Локальный Git**: Включите ключевое слово `"GitLocal"` в ваше сообщение
4. **Ревью Pull Request**: Включите ключевое слово `"ReviewPR"` для анализа PR 🆕
5. **RAG инструменты**: Автоматически используются при индексации документов через экран Ollama

## 💡 Примеры запросов

### Ревью кода
```
ReviewPR сделай ревью для PR #45
ReviewPR проверь pull request AI-with-Love#12
код-ревью для PR #8
```

### GitHub операции
```
GitWithLove покажи информацию о репозитории facebook/react
GitWithLove найди код с использованием Compose в android/compose-samples
```

### Локальный Git
```
GitLocal покажи статус репозитория
GitLocal покажи разницу в файлах
```








